<!DOCTYPE html>
<head>
<meta charset="utf-8">
</head>

<body>
<body bgcolor="#f0f8ff" text="文字色">
    <link rel="stylesheet" href="1.css">
    <title>MM API</title>

    <h1>MM</h1>

    <form name="form">
        <input type="text" name="xid" placeholder="Xbox id" >
        <input type="button" value="検索" onClick="button1();">
        <br><hr><br>
    </form>

  <div id="UUID">UUID : </div>
  <div id="played">初プレイ日 :</div><br>

  <div id="LV">LV : </div>
  <div id="XP">XP : </div>
  <div id="NXP">次のレベルまで 0 XP必要 </div><br>
  
  <div id="play">プレイ回数 : </div>
  <div id="coins">コイン数 : </div>
  <div id="wins">勝利数 : </div>
  <div id="death">死亡数 : </div>
  <div id="kill">殺人数 : </div>
  <div id="killed">退治数 : </div>
    <script>
        
        //ロード時
        window.onload = function(){
        
            // ページ読み込み時に実行したい処理
        if(location.hash)
        {
            var parm = location.hash.replace("#","");
            api_get(parm);
            form.xid.value = parm;
        }
    }

        function button1(){
            api_get(form.xid.value);
        }

    //検索ボタン
        function api_get(xid1) {
            location.hash = xid1;
            fetch("https://api.playhive.com/v0/game/all/murder/"+xid1, {
                "headers": {
                "accept": "*/*",
                "x-csrf-token": ""
            },
        }).then(response => response.json())
        .then(text => {
    
            //console.log(text);

            document.getElementById('UUID').innerHTML = "UUID : <span class='rescolor'>" + text["UUID"]; + "</span>"
            document.getElementById('XP').innerHTML= "XP : <span class='rescolor'>" + text["xp"];
            document.getElementById('play').innerHTML = "プレイ回数 : <span class='rescolor'>" + text["played"]; + "</span>"
            document.getElementById('wins').innerHTML = "勝利数 : <span class='rescolor'>" + text["victories"];
            document.getElementById('death').innerHTML = "死亡数 : <span class='rescolor'>" +  text["deaths"];
            document.getElementById('coins').innerHTML = "コイン数 : <span class='rescolor'>" + text["coins"];
            document.getElementById('kill').innerHTML = "殺人数 : <span class='rescolor'>" + text["murders"];
            document.getElementById('killed').innerHTML = "退治数 : <span class='rescolor'>" + text["murderer_eliminations"];
            if(text["xp"] == 0){
                form.lvl.value = "0";
            }

            var date = new Date(text["first_played"] *1000 );
            document.getElementById('played').innerHTML = "初プレイ日 : <span class='rescolor'>" + (""+date.getFullYear()+
            "/"+(date.getMonth()+1)+
            "/"+date.getDate()+
            " "+date.getHours()+
            ":"+date.getMinutes()+
            ":"+date.getSeconds()); + "</span>"
        
            if(text["xp"] > 0 )
            {
                lvl_(text["xp"]);
            }
    
        }).catch(error => {
            if(error == "SyntaxError: Unexpected token < in JSON at position 0")
            {
                alert('エラーが発生したよ!: アカウントが存在しない可能性があります');
            }
        });



    }

    //lv増幅確認関数
    function lvl_(lxp){
        //Lv計算
        //途中保存用
        var foxp = 0;
        var foxp1 = 0;
        
        //確認部分
        for(let i = 0; i <= 100; i++){
            //lv経験値確認
            //console.log(i + " lv確認  : 以上 ; "+ foxp +" : 未満 ; "+ foxp1);

            //81以上だとXP増幅量が変わるためelseで対応
            if(i <= 81)
            {
                foxp += (i-1) * 100;
                foxp1 += i *100;
            }
            else
            {
                foxp += 8100;
                foxp1 += 8100;
            }

            //total xpが nレベルxp以上かつ n+1レベルxp未満
            if(lxp >= foxp && lxp < foxp1)
            {
                document.getElementById('LV').innerHTML = "LV : <span class='rescolor'>" + i; + "</span>"

                //100レベルじゃなければ
                if(i < 100)
                {
                    document.getElementById('NXP').innerHTML = "次のレベルまであと <span class='rescolor'>" + (foxp1-lxp) + "</span> XP 必要";
                }
                else
                {
                    document.getElementById('NXP').innerHTML = "次のレベルまであと <span class='rescolor'>0</span> XP 必要";
                }

                break;
            }

        }

    }

    </script>
 
</body>